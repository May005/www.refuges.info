<?// Bloc affiché sur la page de recherche

// Ce fichier est l'unique endroit ou peuvent se trouver des balises HTML
// Un couple <ouverture de balise> </fermeture de balise> doit se trouver dans le même fichier et avec la même indentation
// Ce fichier ne contient que des balises HTML et des balises de contrôle PHP
// $modele contient les données passées par le fichier PHP
// $config les données communes à tout WRI

// 17/10/11 Dominique : Création
// 15/02/13 jmb : legere modifs "info_base"
?>

<div class="contenu">
	<!-- =========================== -->
	<h3><?=$modele->titre?></h3>
	<h4>Rechercher sur ce site</h4>

	<!-- =========================== -->
	<form class="wri" method="post" action="./point_recherche.php">

<!-- ========== PREMIER GROUPE: CRITERES COMMUNS ================= -->
<fieldset>
	<legend>Aucun champs n'est obligatoire. Cependant, si la requête est trop large, ce la peut prendre un certain temps</legend>

	<fieldset>
		<!--<legend>Critères principaux</legend>-->
		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="nom" />
			<label title="tout ou partie du nom, par exemple 'jasse' ou 'la pra'" >Nom
				<input type="text" name="nom"/>
			</label>
		</span>
		<label title="type d'hébergement, gîte, cabane ...">Type
			<select name="id_point_type">
				<option value="">(tous)</option>
				<option value="<?=$config['tout_type_refuge']?>" selected="selected">Tout type de refuge</option>
				<?php if (is_array($modele->infos_base->types_point)) 
					foreach ($modele->infos_base->types_point AS $t) {?>
						<option value="<?=$t->id_point_type?>"><?=$t->nom_type?></option>
					<?}?>
			</select>
		</label>
		<label title="Massif ou Zone contenant l'hébergement recherché">Massif: 
			<select name="id_massif">
				<option value="">(partout)</option>
				<?php
					// Ca se complique avec les zones.
					// pour chaque zone, on fait un OPTGROUP, et dedans on reparcours les massifs.
				
					foreach ($modele->zones as $z) { ?>
						<optgroup label="<?=$z->nom_polygone?>">
						<option value="<?=$z->id_polygone?>">(toute la région <?=$z->nom_polygone?>)</option>
						<?php 
						foreach ($modele->massifs AS $m) 
							if( $m->id_zone == $z->id_polygone ) { ?>
								<option value="<?=$m->id_polygone?>"><?=$m->nom_polygone?></option> <?php
							} 
						?></optgroup><?php
					}
				?>
			</select>
		</label>
		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="remark" />
			<label title="exemple: scie, table ..." >
				Le champ remarques contient 
				<input type="text" name="description"/>
			</label>
		</span>
	</fieldset>
	<!-- =========================== -->
	<fieldset>
		<legend title="coché : Avec, décoché: Peu importe" >Attributs divers</legend>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="couvertures" />
			<label>
				<input type="checkbox" name="champs_binaires[]" value="couvertures" />
				Couvertures
			</label>
		</span>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="eau_a_proximite" />
			<label>
				<input type="checkbox" name="champs_binaires[]" value="eau_a_proximite" />
				Eau à proximité
			</label>
		</span>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="bois_a_proximite" />
			<label>
				<input type="checkbox" name="champs_binaires[]" value="bois_a_proximite" />
				Bois à proximité
			</label>
		</span>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="latrines" />
			<label>
				<input type="checkbox" name="champs_binaires[]" value="latrines" />
				Latrines
			</label>
		</span>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="sommaire" />
			<label>
				<input type="checkbox" name="champs_binaires[]" value="sommaire" />
				Abri sommaire
			</label>
		</span>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="clef_a_recuperer" />
			<label>
				<input type="checkbox" name="champs_binaires[]" value="clef_a_recuperer" />
				Clef à récupérer
			</label>
		</span>
	</fieldset>
	<!-- =========================== -->
	<fieldset>
		<legend title="Concerne surtout les cabanes, Il n'y a pas de réservation et des groupes peuvent toujours venir à l'improviste" >Nombre de places</legend>
		<label>
			<input type="text" name="places_minimum" maxlength="3" size="3" />
			minimum
		</label>
		<label>
			<input type="text" name="places_maximum" maxlength="3" size="3" />
			maximum
		</label>
	</fieldset>
	<!-- =========================== -->
	<fieldset>
		<legend title="Restreindre à une altitude en mètres, par exemple 1500 à 2000" >Altitude</legend>
		<label>
			<input type="text" name="altitude_minimum" maxlength="4" size="4" />
			minimum
		</label>
		<label>
			<input type="text" name="altitude_maximum" maxlength="4" size="4" />
			maximum
		</label>
	</fieldset>
	<!-- =========================== -->
	<fieldset>
		<legend title="Concerne surtout les cabanes">Moyen de chauffage</legend>
		<label>
			<input type="radio" name="chauffage" value="chauffage" />
			Poële ou cheminée
		</label>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="cheminee" />
			<label>
				<input type="radio" name="chauffage" value="cheminee" />
				Cheminée
			</label>
		</span>

		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="poele" />
			<label>
				<input type="radio" name="chauffage" value="poele" />
				Poële
			</label>
		</span>

		<label>
			<input type="radio" name="chauffage" value="" checked="checked" />
			Non renseigné
		</label>
	</fieldset>
	<!-- =========================== -->
</fieldset>

<!-- ========== DEUXIEME GROUPE: MODERATION ================= -->
<?php
// attention, les champs sont simplement hidden , mais sont transmits dans le source. 
// jusqu'a present ya rien de critique dans ces champs.
 $visible = '';
 if (!(isset($_SESSION['id_utilisateur']) AND $_SESSION['niveau_moderation'] >= 1))
	$visible = " style='display: none;'" ;
 ?>


<fieldset<?=$visible?>>
	<legend title="Ce cadre n'est pas affiché au 'grand public'">Critères de Modération</legend>
	<fieldset>
		<legend title="en Degrés Decimaux (DD.DDDD) norme WGS84">Recherche par coordonnées GPS</legend>
		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="lat" />
				<label><input type="text" name="lat" maxlength="10" size="8" />Latitude</label>
		</span>
		<span class="champs_null_masque">
			<input type="checkbox" name="champs_null[]" value="lon" />
				<label><input type="text" name="lon" maxlength="10" size="8" />Longitude</label>
		</span>
		<label><input type="text" name="autour" maxlength="6" size="4" value="1000" />Rayon (en mètres)</label>
	</fieldset>
	<!-- =========================== -->
	<fieldset>
		<legend>Tri des résultats</legend>
		<label title="Résultats triés par Zones->Massifs->Reserves">
			<input type="radio" name="avec_liste_polygones" value="montagnarde" checked="checked" />
			"Montagne"
		</label>
		<label title="Résultats triés par Pays->Région->Département">
			<input type="radio" name="avec_liste_polygones" value="administrative" />
			"Administratif"(A éviter, temps de calcul très long !)
		</label>
	</fieldset>
	<!-- =========================== -->
	<fieldset>
		<label title="Un positionnement précis est-il indispensable ?">Précision des coordonnéés GPS :
			<select name="precision_gps" >
			<option value="">(Peu importe)</option>
			<option value="1,2">Prises sur une carte ou le terrain</option>
			<?foreach ($modele->infos_base->type_precision AS $p) {?>
				<option value="<?=$p->id_type_precision_gps?>"><?=$p->nom_precision_gps?></option>
				<?}?>
			</select>
		</label>
		<label title="Le point est ouvert">
			<input type="checkbox" name="ouvert" value="oui" checked="checked" />
			Utilisable (ouvert)
		</label>
		<label title="Selectionner les champs avec valeur 'Inconnu', cocher les cases rouges">
			<input type="checkbox" onchange="show_boxes('champs_null[]',this.checked);" />
			Selectionner champs Inconnus
		</label>
	</fieldset>
</fieldset>

<!-- ========== TROISIEME GROUPE: RESULTATS ================= -->
<fieldset>
	<legend>Résultats</legend>
		<fieldset>
			<label title="Si cette case est cochée, la recherche se limitera aux X premiers résultats">
				<input type="checkbox" name="limite" value="<?=$config['points_maximum_recherche']?>" checked="checked" />
				Limiter le nombre de résultat aux <?=$config['points_maximum_recherche']?> premiers
			</label>
			<label title="En plus des résultats de WRI, inclure les points OpenStreetMap">
				<input type="checkbox" name="osmpois" value="1" disabled="disabled" />
				Inclut les points OpenStreetMap ( non fonctionnel pour l'instant )
			</label>
		</fieldset>

		<label>
			<input type="submit" name="recherche" value="chercher!" />
		</label>
			<!--<input type="submit" name="carte" value="Afficher sur une carte (non fonctionnel)" />-->
</fieldset>
<!-- =========================== -->
			
	</form> 
	<!-- =========================== -->
	<h4>Rechercher dans les Pyrénées ?</h4>
	<p>
		Compléter votre recherche avec l'excellent site 
		<a href="http://www.pyrenees-refuges.com">www.pyrenees-refuges.com</a>
	</p>
	<!-- =========================== -->
</div>

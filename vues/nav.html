<?php
/*
Bloc HTML réalisant l'affichage de la page des cartes

Ce fichier est l'unique endroit ou peuvent se trouver des balises HTML
Un couple <ouverture de balise> </fermeture de balise> doit se trouver dans le même fichier et avec la même indentation
Ce fichier ne contient que des balises HTML et des balises de contrôle PHP
$vue contient les données passées par le fichier PHP
$config les données communes à tout WRI

Concept de Zone et Massifs :
Massif (1): classique : un poly qui entoure tous les points, possibilité de jouer avec le panel de gauche
Zone (11): affiche tous les massifs inclus. pas de points, pas de panel. faut cliquer pour aller sur un massif. comme l'ancienne page massifs.
*/
?>
<div class="contenu">
	<!-- afficher le titre du massif (en mode massif) -->
	<h3 id="titrepage">
        <?if ($vue->mode_affichage == 'edit') {?>
            Edition des contours du massif "<?=$vue->polygone->nom_polygone?>"
        <?}else{?>
            <?=$vue->titre?>
        <?}?>
	</h3>
</div>
<!-- On sort de la page de contenu car pour la carte on ne veut pas les mêmes bordures ni les mêmes options que pour le texte -->

<div id="nav_wrap_carte">
	<div id="nav_bloc_carte"></div>
</div>

<div class="nav_bloc_selecteur">
	<?if (!$vue->mode_affichage ){?>
		<fieldset <?if (!$vue->polygone->nom_polygone ){?>style="display:none"<?}?>>
			<legend>Limites</legend>
				<label>
				<input name="id_massif"
					type="checkbox"
					<?if ( $vue->polygone->id_polygone ){?>checked="checked"<?}?>
					value="<?=$vue->polygone->id_polygone?>"
					onclick="switch_massif(this);maj_poi()"
				/>
				<?=$vue->polygone->nom_polygone?> uniquement
			</label>
		</fieldset>
		<fieldset>
			<legend>Points</legend>
			<ul>
				<? $ktp = explode (',', $_COOKIE['type_points']); // lecture cookie type_points
				foreach ($vue->types_point_affichables AS $type_affichable) {?>
					<li>
						<label>
							<input
								type="checkbox"
								name="point_type[]"
								onclick="maj_poi()"
								value="<?=$type_affichable->point_type?>"
								<?if (!isset ($_COOKIE['type_points']) ||
									in_array ($type_affichable->point_type, $ktp)) {?>
									checked="checked"
								<?}?>
							/>
							<span>
								<img
									id="icone_<?=$type_affichable->point_type?>"
									src="<?=$config['url_chemin_icones'].$type_affichable->icone?>.png"
									alt="icone de <?=$type_affichable->nom_type?>"
								/>
								<?=$type_affichable->nom_type?>
							</span>
						</label>
					</li>
				<?}?>
				<span id="check-types">
					Tout [dé]cocher
					<input type="checkbox" name="check-types-input" onclick="maj_poi(true)" />
				</span>
				<li><a href="<?=$vue->lien_legende_carte?>">légende</a></li>
			</ul>
		</fieldset>
		<fieldset class="nav-services">
			<legend><a href="https://overpass-turbo.eu/">Services</a></legend>
			<img id="over-zoom" title="Zoomer pour voir les points" src="<?=$config['sous_dossier_installation']?>images/loupe-rouge.png" />
			<img id="over-wait" title="Chargement en cours" src="<?=$config['sous_dossier_installation']?>images/wait.gif" />
			<ul>
				<? foreach (array (
					'H&ocirc;tels' => 'tourism~hotel',
					'Campings' => 'tourism~camp_site',
					'Alimentation' => 'shop~supermarket|convenience',
					'Parkings' => 'amenity~parking',
				) AS $k => $v) {?>
					<li><label>
						<input type="checkbox" name="service_type[]" value="<?=$v?>" onclick="poiOVER.reload()" />
						<?=$k?>
					</label></li>
				<?}?>
			</ul>
		</fieldset>
		<fieldset class="nav-sites">
			<legend>Autres sites</legend>
			<ul>
				<? foreach (array (
					'poiPRC' => 'pyrenees-refuges.com',
					'poiC2C' => 'camptocamp.org',
					'poiCHEM' => 'chemineur.fr',
				) AS $k => $v) {?>
					<li><label>
						<input type="checkbox" title="Cocher pour afficher les points <?=$v?> sur la carte" onclick="maj_autres_site(this, <?=$k?>)" />
						<a href="http://www.<?=$v?>/" title="Cliquer pour aller sur <?=$v?>"><?=$v?></a>
					</label></li>
				<?}?>
			</ul>
		</fieldset>
	<?}?>

	<?php if ( !$vue->mode_affichage && $_SESSION['niveau_moderation']>=1 ) {?>
		<fieldset>
			<legend>Modification</legend>
			<label>
				<a href="?mode_affichage=edit"><?= $vue->polygone->id_polygone ? 'Modifier le' : 'Créer un'?> massif</a>
			</label>
		</fieldset>
	<?}?>

	<?php if ( $vue->mode_affichage == 'edit' && $_SESSION['niveau_moderation']>=1 ) {?>
		<form method="post" action="<?=$config['sous_dossier_installation']?>nav/<?=$vue->polygone->id_polygone?>?mode_affichage=edit" >
			<fieldset>
				<legend><?=$vue->polygone->id_polygone ? 'Edition' : 'Création'?></legend>
				<!-- Edition du massif -->
				<label>
					<input type="hidden" name="id_polygone" value="<?=$vue->polygone->id_polygone?>" />
					<input type="hidden" name="json_polygones" id="edit-json" value='<?=$vue->json_polygones?>' />

					<p>Nom du massif
					<input type="text" name="nom_polygone" size="20" value="<?=$vue->polygone->nom_polygone?>" /></p><br/>

					<p>Article partitif (max 20 car)
					<input type="text" name="article_partitif" size="9" value="<?=$vue->polygone->article_partitif?>" /></p><br/>

					<p><div id="edit-changed" style="display:none"><i style="color:red">Polygone modifié</i></div></p>

					<input type="submit" name="enregistrer" value="Enregistrer" />&nbsp;
					<a href="?" title="Sans sauvegarder">Quiter le mode édition sans enregistrer</a>
				</label>
			</fieldset>
			<?if ($vue->polygone->id_polygone) {?>
				<fieldset>
					<legend>Suppression</legend>
					<label>
						<?if (!$_GET['test_supprimer']) {?>
							<p>
								<a href="<?=$config['sous_dossier_installation']?>nav/<?=$vue->polygone->id_polygone?>?mode_affichage=edit&amp;test_supprimer=1">
									Supprimer le massif
								</a>
							</p>
						<?}else{?>
							<b>
								<p style="color:red">ATTENTION: Ceci va supprimer définitivement le massif "<?=$vue->polygone->nom_polygone?>"</p>
								<p style="color:red">Aucune restauration ne sera possible</p>
							</b>
							<input type="submit" name="annuler" value="Annuler" style="float:right" />
							<input style="color:red;background-color:yellow" type="submit" name="supprimer" value="Supprimer '<?=$vue->polygone->nom_polygone?>'" />
							<br />&nbsp;
						<?}?>
					</label>
				</fieldset>
			<?}?>
				<fieldset>
					<legend>Edition</legend>
					<label>
						<p><u>Créer un polygone:</u> Cliquer sur le contrôle "polygone"</p>
						<p><u>Supprimer un polygone:</u> Cliquer sur le contrôle "poubelle"</p>
						<p><u>Ajouter un sommet:</u> Déplacer un marqueur au milieu d'un segment</p>
						<p><u>Déplacer un sommet:</u> Le déplacer</p>
						<p><u>Supprimer un sommet:</u> Cliquer une fois dessus</p>
						<p><u>Découper un polygone:</u> Cliquer une fois sur un marqueur au milieu d'un segment</p>
						<p><u>Fusionner deux lignes:</u> Joindre les extrémités</p>
						<p><u>Fermer une ligne:</u> Joindre ses deux extrémités</p>
					</label>
				</fieldset>
		</form>
		<div id="help-edit"></div>
	<?}else
		foreach (array (
			'Click'        => '',
			'Maj + Ctrl + Click' => ' dans un nouvel onglet',
			'Ctrl + Click' => ' dans un nouvel onglet mais reste sur la carte (Sauf Mozilla)',
			'Maj + Click'        => ' dans une nouvelle fenêtre',
		) AS $k => $v)
			echo $vue->mode_affichage
				? "<p>$k massif: affiche le massif$v.</p>"
				: "<p>$k icône: affiche le point$v.</p>";
	?>
</div>

<?// Bloc HTML réalisant l'affichage de la page de modification d'une fiche

// Ce fichier est l'unique endroit ou peuvent se trouver des balises HTML
// Un couple <ouverture de balise> </fermeture de balise> doit se trouver dans le même fichier et avec la même indentation
// Ce fichier ne contient que des balises HTML et des balises de contrôle PHP
// $vue contient les données passées par le fichier PHP
// $config les données communes à tout WRI

// 27/05/12 Dominique : Création
?>

<section id="page_modif_point">
    <h2>Édition d'un point.</h2>
	<?
	if (!count($vue->etapes))
  { ?>
    <dl> <?
    foreach ($vue->etapes as $etape)
    {
      // les etapes en listes DT, plus approprié, le style au besoin en CSS
      ?>
      <dt><?=$etape->titre?></dt>
      <dd><?=$etape->texte?></dd>
    <?}?>
    </dl>  <?
  }
?>
    <form id="form_point" method="post" onsubmit="return validation();" action="<?=$config['sous_dossier_installation']?>point_modification.php">
    <div class="contenu" style="display: flex;"><?
    foreach ($vue->champs->boutons as $bouton) { ?> 
      <button class="button" style="flex: 1;" type="<?=$bouton->type?>" name="<?=$bouton->nom?>" value="<?=$bouton->valeur?>" onclick="choix='<?=$bouton->valeur?>'">
        <?=$bouton->label?>
      </button>
    <?}?>
    </div>
    <div>
    <!-- Champs cachés -->
    <?
    foreach ($vue->champs->invisibles as $nom => $params)
    { ?>
      <input type="hidden" name="<?=$nom?>" value="<?=$params->valeur?>" />
    <?}?>
    </div>

    <article>
    <h3 style="margin-bottom: 0">Coordonnées</h3>
        <div id="flexcontainer">
            <fieldset class="section" style="flex: 1;">
                <label for="curseur-proj-lng" style="width: 100px;">
                    Longitude :
                </label>
                    <input type="text" id="curseur-proj-lng" name="longitude" size="12" maxlength="12" value="<?=$vue->point->longitude?>" />
                    <input type="hidden" id="curseur-lng" name="longitude" value="<?=$vue->point->longitude?>" />
                <br>
                <label for="curseur-proj-lat" style="width: 100px;">
                    Latitude :
                </label>
                    <input type="text" id="curseur-proj-lat" name="latitude"  size="12" maxlength="12" value="<?=$vue->point->latitude?>" />
                    <input type="hidden" id="curseur-lat" name="latitude" value="<?=$vue->point->latitude?>" />
                <br>
                <label for="curseur-select-projection" style="width: 100px;">
                    
                </label>
                    <select id="curseur-select-projection"></select>
                <br>
                <small>Déplacez le viseur pour modifier la position (n'oubliez pas de valider).</small>
                <span class="details" > <i><small><strong>Attention:</strong> Ces coordonnées sont relatives à l'ellipsoïde WGS84. Il se peut qu'elles ne correspondent pas pour d'anciennes cartes. Consultez le cartouche de la carte pour vérifier son ellipsoïde de référence.</small></i></span>
                <br>
                <br>
    			<a class="button" onclick="curseur.setLatLng(map.getCenter())" href="#">Remettre le viseur au centre actuel de la carte</a>
                <br>
                <a class="button" onclick="gps.activate()" href="#">Utiliser la position du GPS</a>
    			<br>
                <br>
                <label for="id_type_precision_gps" style="min-width: 100px;">Provenance</label>
                    <select name="id_type_precision_gps" id="id_type_precision_gps">
                    <?php foreach ($vue->infos_base->type_precision AS $gps) { ?>
                        <option  value="<?=$gps->id_type_precision_gps?>"<?=($gps->id_type_precision_gps==$vue->point->id_type_precision_gps)? ' selected="selected"' : '' ;?>>
                            <?=$gps->nom_precision_gps ?>
                        </option>
                    <?}?>
                    </select>
                <br>
                <label for="altitude" style="min-width: 100px;">Altitude :</label>
                    <input type="text" name="altitude" id="altitude" size="6" value="<?=$vue->point->altitude?>" /> m
            </fieldset>
            <div class="carte_edit" id="carte-edit" style="flex: 1;"></div>
        </div>
    </article>
            
    <h3>Informations de base:</h3>
    <article class="contenu">
        <fieldset>
            <label for="nom">Nom :</label>
                <input size="40" type="text" name="nom" id="nom" value="<?=$vue->point->nom?>" />
            <br>
            <label for="id_point_type">Type de point :</label>
                <select name='id_point_type' id="id_point_type">
                <?php foreach ($vue->infos_base->types_point AS $type_point) { ?>
                    <option  value="<?=$type_point->id_point_type?>" <?=($type_point->id_point_type==$vue->point->id_point_type)? 'selected="selected"' : '' ;?>>
                        <?=$type_point->nom_type?>
                    </option>
                <?}?>
                </select>
                <span class="details"> <small>
                <a href="<?=$vue->lien_aide_points?>">
                    Explications plus précises sur les différents types de points
                </a></small></span>
            </fieldset>

            <?php if ($_SESSION['niveau_moderation']>=1 and $vue->point->id_point) {?>
				<span class="admin"><label for="id_createur">&nbsp;Créateur de cette fiche: ID =</label>
					<input size="4" type="text" name="id_createur" id="id_createur" value="<?=$vue->point->id_createur?>" /></span>
				<br>
            <?}?>

            <?php // tous les points n'ont pas de raison d'avoir ce champ ( lac, sommets, etc.)
                if ($vue->point->equivalent_places!="") {?>
                    <label for="places"><?=$vue->point->equivalent_places?> :</label>
                        <input type="text" name="places" id="places" size="8" value="<?=$vue->point->places?>" />
                    
            <?}?>
        </fieldset>
        <br>
        <br>
        <fieldset>
                <a target="_blank" href="<?=$vue->lien_bbcode?>">Syntaxe possible</a>
                <br>
                    <?php foreach ($vue->champs->textareas as $tx_nom => $tx_params) { ?>
                    <label class="textarea" id="<?=$tx_nom?>"><span><?=$tx_params->label?></span></label>
                        <textarea class="textarea" rows="5" name="<?=$tx_nom?>" id="<?=$tx_nom?>"><?=$tx_params->valeur?></textarea>
                    
		
<?php } ?>
        </fieldset>
    </article>

    <h4>Informations complémentaires</h4>
	
	<?php if ($vue->champs->censure->actif) { ?>
	<fieldset class="booleen">
	    <legend<?=(isset($vue->champs->censure->aide))? ' title="'.$vue->champs->censure->aide.'"':'';?>><?=$vue->champs->censure->label?></legend>
	        <label>oui<input type="radio" name="censure" value="TRUE" <?=($vue->champs->censure->valeur===true)?'checked="checked"':'';?>/></label>
	        <label>non<input type="radio" name="censure" value="FALSE" <?=($vue->champs->censure->valeur===false)?'checked="checked"':'';?>/></label>
	</fieldset>
	<?php } ?>

	<?php if ($vue->champs->conditions_utilisation) { ?>
	<fieldset class="booleen">
	    <legend>État :</legend>
	    <?php foreach ( $vue->champs->conditions_utilisation->options as $option_key => $option_val) { ?>
	        <label><?=$option_val?>
                      <input type="radio" name="conditions_utilisation" value="<?=$option_key?>"<?=($vue->champs->conditions_utilisation->valeur==$option_key)?' checked="checked"':'';?> />
                </label>
            <?php } ?>
         </fieldset>
         <?php } ?>

         <?php if (!empty($vue->champs->places_matelas->label) ) {
             // rendre le champs invisible si l'option etait "ne sait pas" ou "ya pas"
             if ( is_int($vue->champs->places_matelas->valeur) && $vue->champs->places_matelas->valeur >= 0 ) // est 0 ou N
                 $visible = 'visible';
             else                     // NULL ou -1
                 $visible = 'hidden';
         } ?>
                
         <?php if (!empty($vue->champs->places_matelas->label) ) { ?>
         <fieldset class="booleen">
                  <legend><?=$vue->champs->places_matelas->label?> :</legend> 
                    <label>ne sait pas
                        <input type="radio" name="pm_radio" onclick="affiche_et_set('places_matelas','hidden','NULL');" <?=($vue->champs->places_matelas->valeur=='NULL')?' checked="checked"':'';?> />
                    </label>
                    <label>sans
                        <input type="radio" name="pm_radio" onclick="affiche_et_set('places_matelas','hidden','-1');" <?=($vue->champs->places_matelas->valeur=="-1")?' checked="checked"':'';?> />
                    </label>
                    <label>avec
                        <input type="radio" name="pm_radio" onclick="affiche_et_set('places_matelas','visible','');" <?=($visible == 'visible')?' checked="checked"':'';?> />
                    </label>
                    <label>
                        <input type="text" id="places_matelas" size="4" name="places_matelas"
                                value="<?=$vue->champs->places_matelas->valeur?>"
                                style="visibility: <?=$visible?>;"
                                title="<?=$vue->champs->places_matelas->aide?>"
                        />
                    </label>
                </fieldset>
                <?php } ?>
                
                <?php foreach ($vue->champs->bools as $nom => $params) { ?>
                <fieldset class="booleen">
                        <legend<?=(isset($params->aide))? ' title="'.$params->aide.'"':'';?>><?=$params->label?> :</legend>
                        <label>ne sait pas<input type="radio" name="<?=$nom?>" value="NULL" <?=($params->valeur===null)?'checked="checked"':'';?>/></label>
                        <label>oui<input type="radio" name="<?=$nom?>" value="TRUE" <?=($params->valeur===true)?'checked="checked"':'';?>/></label>
                        <label>non<input type="radio" name="<?=$nom?>" value="FALSE" <?=($params->valeur===false)?'checked="checked"':'';?>/></label>
                </fieldset>
                <?php } ?>
                <?php if (!empty($vue->point->equivalent_site_officiel) ) { ?>
                <fieldset class="booleen">
                        <legend><?=$vue->point->equivalent_site_officiel?> :</legend>
                        <label>
                                <input name="site_officiel" size="50" type="text" value="<?=$vue->point->site_officiel?>" />
                        </label>
                </fieldset>
                <?php } ?>
                
                <?php if (!isset($_SESSION['id_utilisateur'])) { ?>
                <br style="clear: both;">
                <h4>Questions pour les contributeurs anonymes</h4>
                <fieldset class="booleen">
                    <legend>Votre nom ou pseudo (facultatif) :</legend>
                    <label>
                        <input type="text" name="nom_createur" maxlength="40" size="41" value="" />
                    </label>
                </fieldset>
                <fieldset class="booleen">
                    <label title="Cette procédure permet de s'assurer que les 'robots' qui parcourent le Net ne vienne pas jusqu'ici">
                        Entrez la lettre <strong>d</strong>
                        <input name="lettre_securite" type="text" size="1" />
                    </label>
                </fieldset>
                <?}?>
                
    <div class="contenu" style="display: flex;"><?
    foreach ($vue->champs->boutons as $bouton) { ?> 
      <button class="button" style="flex: 1;" type="<?=$bouton->type?>" name="<?=$bouton->nom?>" value="<?=$bouton->valeur?>" onclick="choix='<?=$bouton->valeur?>'">
        <?=$bouton->label?>
      </button>
    <?}?>
    </div>
	</form>
</section>